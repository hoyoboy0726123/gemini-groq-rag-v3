# Gemini + Groq RAG V3

> 本地端 RAG（檢索增強生成）知識庫系統，採用 **Gemini 向量化 × Groq Llama 4 超快推理** 雙模型混合架構。
> 所有文件與向量資料儲存於瀏覽器本機（IndexedDB），**不上傳伺服器、完全免費使用**。

🌐 **線上 Demo**：[https://hoyoboy0726123.github.io/gemini-groq-rag-v3/](https://hoyoboy0726123.github.io/gemini-groq-rag-v3/)

---

## 目錄

- [功能特色](#功能特色)
- [系統架構](#系統架構)
- [使用前準備：取得 API Key](#使用前準備取得-api-key)
  - [Step 1：取得 Google Gemini API Key](#step-1取得-google-gemini-api-key)
  - [Step 2：取得 Groq API Key](#step-2取得-groq-api-key)
- [本機開發環境安裝](#本機開發環境安裝)
- [詳細操作教學](#詳細操作教學)
  - [1. 登入畫面：輸入 API Key](#1-登入畫面輸入-api-key)
  - [2. 主介面總覽](#2-主介面總覽)
  - [3. 上傳 PDF 文件到知識庫](#3-上傳-pdf-文件到知識庫)
  - [4. 管理文件分類](#4-管理文件分類)
  - [5. 與知識庫對話（RAG 問答）](#5-與知識庫對話rag-問答)
  - [6. 相似度門檻調整](#6-相似度門檻調整)
  - [7. PDF 頁面視覺分析](#7-pdf-頁面視覺分析)
  - [8. 備份與還原知識庫](#8-備份與還原知識庫)
  - [9. 技術規格面板](#9-技術規格面板)
- [常見問題 FAQ](#常見問題-faq)
- [技術規格](#技術規格)
- [免費額度說明](#免費額度說明)

---

## 功能特色

| 功能 | 說明 |
|------|------|
| **PDF 智能上傳** | 自動辨別「文字型」與「掃描型（圖片型）」PDF，掃描型自動觸發 OCR |
| **RAG 問答** | 上傳文件後，直接用中文提問，AI 從知識庫找答案 |
| **PDF 頁面視覺分析** | 直接「看」PDF 頁面截圖，分析圖表、表格、掃描文件 |
| **分類管理** | 依主題分類文件，提問時可篩選特定分類 |
| **備份還原** | 一鍵匯出 / 匯入整個知識庫（含向量資料） |
| **完全本地端** | 所有資料存在瀏覽器 IndexedDB，不上傳任何伺服器 |
| **雙免費額度** | Gemini Free Tier + Groq Free Tier，零成本使用 |

---

## 系統架構

```
使用者問題
    │
    ▼
【Groq】意圖分析（判斷是否需要搜尋文件）
    │
    ├─ 需要搜尋 ─▶ 【Gemini】將問題向量化
    │                   │
    │                   ▼
    │              IndexedDB 余弦相似度搜尋
    │                   │
    │                   ▼
    │              取出最相關文字區塊
    │
    └─ 一般對話 ─▶ 直接傳入對話歷史
                        │
                        ▼
                【Groq Llama 4】生成回答
```

- **Gemini** (`gemini-embedding-001`)：負責將文字轉換為 3072 維向量
- **Groq Llama 4 Scout**：負責意圖分析、RAG 對話生成、PDF 圖像 OCR 與視覺分析
- **IndexedDB**：瀏覽器本機資料庫，儲存文件內容、向量、對話記錄

---

## 使用前準備：取得 API Key

本工具需要兩組 API Key，**兩者皆有免費方案，不需要信用卡**。

---

### Step 1：取得 Google Gemini API Key

1. 前往 [https://aistudio.google.com/apikey](https://aistudio.google.com/apikey)
2. 使用 Google 帳號登入
3. 點擊右上角 **「建立 API 金鑰」**
4. 選擇「在新專案中建立 API 金鑰」
5. 複製產生的 Key（格式：`AIzaSy...`）

> **免費額度**：每分鐘 15 次請求（RPM），每天 1500 次，足夠個人使用

---

### Step 2：取得 Groq API Key

1. 前往 [https://console.groq.com/keys](https://console.groq.com/keys)
2. 點擊 **「Sign Up」** 或 **「Log In」** 建立帳號（可用 Google/GitHub 登入）
3. 登入後點擊 **「Create API Key」**
4. 輸入 Key 名稱（例如：`my-rag-app`），點擊 Submit
5. 複製產生的 Key（格式：`gsk_...`）

> **免費額度**：每天 14,400 次請求，每次最多 131,072 tokens

---

## 本機開發環境安裝

### 系統需求

- Node.js 18 以上（建議 20）
- npm 9 以上

### 安裝步驟

```bash
# 1. Clone 專案
git clone https://github.com/hoyoboy0726123/gemini-groq-rag-v3.git
cd gemini-groq-rag-v3

# 2. 安裝依賴套件
npm install

# 3. 啟動開發伺服器
npm run dev
```

啟動後在瀏覽器開啟 **http://localhost:5173**

### 建置正式版

```bash
npm run build
# 產出檔案在 ./dist 資料夾
```

---

## 詳細操作教學

### 1. 登入畫面：輸入 API Key

開啟應用程式後，會看到登入畫面，需要分兩步驟輸入 API Key：

**步驟 1：輸入 Gemini API Key**

- 在「Google AI Studio API Key」欄位貼上 `AIzaSy...` 格式的 Key
- 點擊「**下一步**」

**步驟 2：輸入 Groq API Key**

- 在「Groq API Key」欄位貼上 `gsk_...` 格式的 Key
- 點擊「**開始使用**」

系統會自動驗證兩組 Key 是否有效：
- ✅ 綠色「驗證成功！」→ 進入主介面
- ❌ 紅色錯誤訊息 → 請確認 Key 正確，或前往 API 平台確認額度未超限

> **注意**：API Key 僅儲存在瀏覽器記憶體，關閉視窗後需重新輸入

---

### 2. 主介面總覽

進入主介面後，畫面分為左右兩個區域：

```
┌─────────────────────┬──────────────────────────────────┐
│   左側：知識庫側欄   │         右側：對話區域            │
│                     │                                  │
│  ・分類清單          │  ・對話訊息顯示                   │
│  ・文件列表          │  ・支援 Markdown / 表格渲染        │
│  ・儲存空間統計       │  ・輸入框 + 送出按鈕              │
│  ・相似度門檻滑桿     │  ・清除對話按鈕                   │
│  ・PDF 視覺分析       │                                  │
│  ・備份 / 技術規格    │                                  │
│  ・新增文件按鈕       │                                  │
└─────────────────────┴──────────────────────────────────┘
```

---

### 3. 上傳 PDF 文件到知識庫

點擊左側側欄右下角的 **「新增文件」** 按鈕，開啟上傳視窗。

#### 3.1 選擇 PDF 檔案

- 點擊虛線框區域，或直接拖曳 PDF 檔案到框內
- 選取檔案後，系統自動分析文件類型：

| 類型 | 說明 | 處理方式 |
|------|------|---------|
| **文字型 PDF** | 一般文字 PDF（Word 轉存、原生 PDF） | 直接解析文字 |
| **圖片型 PDF** | 掃描版、影印版、純圖片 PDF | 自動 OCR（使用 Groq Vision AI） |

分析完成後會顯示：
- 頁數
- 預估產生的文字區塊數量
- 預估處理時間

#### 3.2 設定分類

**使用現有分類**（第一次上傳時不可用）：
- 選擇「現有分類」，從下拉選單選取

**建立新分類**：
- 選擇「新分類」，輸入分類名稱（例如：`財務報告`、`法規文件`、`技術手冊`）

#### 3.3 開始處理

點擊「**開始處理**」，系統執行以下流程：

1. **偵測 PDF 類型**（文字型 / 圖片型）
2. **解析文字**
   - 文字型：直接從 PDF 提取文字
   - 圖片型：逐頁截圖 → Groq Vision OCR 識別文字
3. **向量化**（Gemini Embedding）：將文字切分為區塊，每個區塊轉為 3072 維向量
4. **儲存**至 IndexedDB

> **處理時間估算**：
> - 文字型 PDF：每 10 個區塊約 45 秒（Gemini 免費方案限速）
> - 圖片型 PDF：每頁約 3-5 秒（OCR），加上向量化時間
> - 100 頁掃描版文件約需 15-20 分鐘

處理期間，底部狀態列會顯示即時進度，請勿關閉視窗。

---

### 4. 管理文件分類

#### 4.1 展開 / 收合分類

點擊分類名稱（資料夾圖示旁），可展開查看該分類下的所有文件。

#### 4.2 勾選分類（篩選搜尋範圍）

每個分類前方有一個 **勾選框**：
- ☑ 勾選：提問時只搜尋此分類的文件
- ☐ 未勾選：不限定分類（搜尋全部）

**範例**：若上傳了「財務報告」和「法規文件」兩個分類，只想問財務相關問題時，可只勾選「財務報告」，避免 AI 從法規文件中找到不相關答案。

#### 4.3 重新命名分類

滑鼠移到分類上，點擊 ✏️ 鉛筆圖示，輸入新名稱後按確認。

#### 4.4 刪除分類

滑鼠移到分類上，點擊 🗑️ 垃圾桶圖示，確認後刪除整個分類及其所有文件。

#### 4.5 刪除單一文件

展開分類後，滑鼠移到文件名稱上，點擊右側出現的 🗑️ 圖示即可刪除。

#### 4.6 清空所有資料

點擊側欄「分類清單」右側的 🗑️ 圖示，確認後清空**所有文件、向量及對話記錄**（此操作無法復原）。

---

### 5. 與知識庫對話（RAG 問答）

上傳文件後，在右側對話框輸入問題，按 **Enter** 或點擊送出按鈕。

#### 問答流程說明

系統自動判斷問題意圖：

- **需要查文件**（例如：「合約中的違約條款是什麼？」）
  1. 用 Gemini 將問題向量化
  2. 在 IndexedDB 中搜尋最相似的文字區塊
  3. 將相關段落交給 Groq Llama 4 生成答案

- **一般對話**（例如：「你是誰？」、「幫我整理上面提到的重點」）
  1. 直接使用對話歷史讓 Groq 回答，不搜尋文件

#### 回答格式

AI 回答支援完整的 **Markdown 格式**：
- 標題（`# ## ###`）
- 粗體、斜體
- 條列清單（`-` 或數字清單）
- 表格（資料類問題自動整理成表格）
- 程式碼區塊

#### 找不到相關資訊時

若問題無法在知識庫中找到足夠相似的內容（相似度低於門檻），AI 會回覆：
> 「知識庫中無相關資訊。請嘗試換個問法或上傳相關文件。」

此時可嘗試：
1. 換個更具體的問法
2. 降低相似度門檻（參考下方說明）
3. 確認已上傳相關文件

#### 清除對話記錄

點擊對話區右上角的清除按鈕，可清空對話歷史（知識庫文件不受影響）。

---

### 6. 相似度門檻調整

位於側欄底部的 **「相似度門檻」** 滑桿，範圍 0%～100%，預設值 25%。

| 設定值 | 效果 | 適用情況 |
|--------|------|---------|
| **低（0-20%）** | 寬鬆搜尋，更容易找到相關段落 | 文件內容龐雜、問法不夠精確 |
| **中（25-40%）** | 平衡模式（預設） | 一般使用 |
| **高（50%+）** | 嚴格搜尋，只返回高度相關內容 | 確保答案精確、文件內容清晰 |

**調整建議**：
- 如果 AI 常回答「無相關資訊」，嘗試將門檻調低至 15-20%
- 如果 AI 回答內容不夠精確，嘗試將門檻調高至 40-50%

---

### 7. PDF 頁面視覺分析

適用於：圖表、掃描版文件、含有圖片的 PDF 頁面。

點擊側欄的 **「PDF 頁面視覺分析」** 按鈕開啟功能。

#### 7.1 上傳 PDF

點擊左上角上傳區域，選取要分析的 PDF 檔案。

#### 7.2 預覽與選頁

- 左側顯示 PDF 頁面預覽，可用 ◀ ▶ 按鈕翻頁
- 點擊 **「截取此頁」** 將當前頁面加入選取清單
- 可選取最多 5 頁進行單次分析

#### 7.3 提問

在右側輸入框輸入問題，點擊送出。AI 會直接「看」你選的頁面截圖回答。

**適用案例**：
- 「請描述第 3 頁的圖表內容」
- 「這個表格裡的數字代表什麼？」
- 「幫我把這頁掃描文件的文字全部打出來」
- 「第 2 頁和第 4 頁的數據有什麼差異？」

#### 7.4 批量分析模式（超過 5 頁）

若需要分析大量頁面（例如整份 PDF），選取超過 5 頁後系統自動啟用批量分析：

1. 系統智能分批（每批最多 5 頁，總大小限 3MB）
2. 逐批送給 Groq Vision AI 分析
3. 最後整合所有批次結果生成完整回答

> **注意**：每張截圖大小約 100-300KB，建議單次選取不超過 10 頁以避免超時。

#### 7.5 限制說明

| 限制項目 | 數值 |
|---------|------|
| 單次最多頁數 | 5 頁（超過自動批量） |
| 圖片總大小上限 | 3.5MB |
| 請求超時 | 60 秒 |
| 批量分析超時 | 90 秒 / 批 |

---

### 8. 備份與還原知識庫

點擊側欄的 **「備份」** 按鈕，開啟匯出 / 匯入視窗。

#### 8.1 匯出（備份）

點擊「**下載備份檔案**」，系統將所有資料匯出為 JSON 檔案，命名格式：
```
rag-backup-2025-02-26.json
```

備份內容包含：
- 所有文件的中繼資料（名稱、分類）
- 所有向量區塊（文字內容 + 3072 維向量）
- 完整對話記錄

> **建議**：定期備份，尤其是處理大量文件後

#### 8.2 匯入（還原）

1. 切換至「**匯入**」分頁
2. 選擇是否勾選「清空現有資料後再匯入」
   - ☑ 勾選：完全取代現有知識庫（適合換電腦後還原）
   - ☐ 未勾選：合併匯入（適合增加文件）
3. 點擊上傳區域，選取 `.json` 備份檔案
4. 自動完成匯入，顯示匯入統計

---

### 9. 技術規格面板

點擊側欄的 **「技術」** 按鈕，查看當前系統狀態：

- **儲存空間使用量**：文件、向量、對話記錄分別佔用多少空間
- **文件統計**：文件數量、總區塊數
- **模型資訊**：目前使用的 Gemini Embedding 和 Groq 模型版本
- **API 速率限制**：當前設定的請求頻率

---

## 常見問題 FAQ

**Q：API Key 會被其他人看到嗎？**
> A：不會。Key 只儲存在瀏覽器的 JavaScript 記憶體中，不會傳送到任何第三方伺服器，也不會儲存到本地磁碟。但每次重新整理頁面或關閉視窗後都需要重新輸入。

**Q：處理 PDF 時卡在向量化進度，很久都沒動？**
> A：Gemini 免費方案每分鐘只能處理 15 次請求，每次請求間隔至少 4.5 秒，這是正常現象。50 個區塊約需 3-4 分鐘，請耐心等待，不要關閉視窗。

**Q：掃描版 PDF OCR 效果不好？**
> A：OCR 使用 Groq Llama 4 Vision，對清晰度高的掃描文件效果良好，模糊或低解析度文件可能識別不完整。可嘗試使用「PDF 頁面視覺分析」功能，針對特定頁面直接提問。

**Q：出現「API 請求過於頻繁，請稍後再試」？**
> A：超過 Groq 免費額度的每分鐘請求限制（30 RPM），等待 1-2 分鐘後再試。

**Q：關閉瀏覽器後資料還在嗎？**
> A：是的。文件和向量資料存在 IndexedDB（瀏覽器本機資料庫），關閉瀏覽器後依然保留。但清除瀏覽器資料時會一併刪除，建議定期使用備份功能。

**Q：可以上傳 Word 或 Excel 檔案嗎？**
> A：目前僅支援 PDF 格式。Word 文件請先另存為 PDF 後再上傳。

**Q：處理後的文件可以跨電腦使用嗎？**
> A：可以。使用「備份」功能匯出 JSON 檔案，在另一台電腦的同一個應用程式中匯入即可。

**Q：為什麼選擇 Gemini 做向量化、Groq 做對話，而不是用同一個服務？**
> A：`gemini-embedding-001` 是目前免費方案中維度最高（3072）的向量模型，搜尋精準度優秀。Groq 的 Llama 4 推理速度極快（約 200 tokens/秒），且支援視覺功能。兩者結合可同時利用各自的免費額度，達到最大效益。

---

## 技術規格

| 項目 | 詳細 |
|------|------|
| **前端框架** | React 18 + Vite 4 |
| **UI 樣式** | Tailwind CSS 3 |
| **本地資料庫** | IndexedDB（使用 `idb` 函式庫） |
| **PDF 解析** | `pdfjs-dist` 4.0 |
| **Gemini 模型** | `gemini-embedding-001`（向量維度：3072） |
| **Groq 模型** | `meta-llama/llama-4-scout-17b-16e-instruct` |
| **向量搜尋演算法** | 餘弦相似度（Cosine Similarity） |
| **文字切分策略** | 每區塊約 500 字元，帶重疊 |
| **OCR 方式** | Groq Vision API（逐頁截圖辨識） |

---

## 免費額度說明

| 服務 | 免費限制 | 本專案使用 |
|------|---------|-----------|
| **Google Gemini** | 15 RPM / 1,500 RPD / 1M TPM | 向量化（上傳文件時使用） |
| **Groq** | 30 RPM / 14,400 RPD / 131K tokens per request | 對話、意圖分析、OCR、視覺分析 |

> RPM = 每分鐘請求數 / RPD = 每日請求數 / TPM = 每分鐘 Token 數

一般個人使用完全不會超出免費額度。大量批量上傳文件時可能需要等待 Gemini 的速率限制冷卻。

---

## License

MIT
